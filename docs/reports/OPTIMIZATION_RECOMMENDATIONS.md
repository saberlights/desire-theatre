# 欲望剧场插件 - 优化建议清单

## 基于实际测试的优化建议

---

## 🔴 P0 - 必须修复 (影响功能)

### 1. 系统类动作缺少必需字段

**问题**:
5个系统类动作缺少 `base_intensity` 字段：
- 穿 (outfit)
- 喂 (item)
- 用 (item)
- 戴 (item)
- 去 (scene)

**影响**: 配置不一致，虽然不影响功能但会在某些验证中报错

**修复方案**:
```json
// actions.json
"穿": {
  "type": "outfit",
  "base_intensity": 0,  // 添加此行
  "handler": "outfit_system",
  "description": "更换服装"
},
"喂": {
  "type": "item",
  "base_intensity": 0,  // 添加此行
  "handler": "item_system",
  "description": "给她喂食"
},
// ... 其他系统动作同样处理
```

**优先级**: 高
**工作量**: 10分钟

---

## 🟡 P1 - 强烈建议 (改善体验)

### 1. 职业收入配置验证

**问题**:
测试显示所有职业的 `daily_income` 都是 0

**当前状态**:
```python
职业示例:
  - 高中生: 收入 0币/天
  - 大学生: 收入 0币/天
  - 普通职员: 收入 0币/天
```

**需要检查**:
1. 是否是测试方法的问题？
2. 还是配置确实缺失？

**修复方案**:
检查 `career_system.py` 中的职业配置：
```python
CAREERS = {
    "student_high": {
        "name": "高中生",
        "daily_income": 0,  # 确认这是否正确
        ...
    },
    "office_worker": {
        "name": "普通职员",
        "daily_income": 50,  # 应该有收入
        ...
    }
}
```

**优先级**: 中
**工作量**: 30分钟

### 2. 温柔路线流程测试失败

**问题**:
温柔路线测试遇到API兼容性问题

**错误**:
```python
TypeError: unsupported operand type(s) for &: 'str' and 'int'
```

**原因**:
`EvolutionSystem.check_evolution()` 期望接收字典，但收到了 Peewee 模型对象

**修复方案**:
在测试中转换模型为字典，或者修改 `check_evolution` 支持两种输入：

```python
# 方案A: 修改测试代码
char_dict = {
    'evolution_stage': char.evolution_stage,
    'affection': char.affection,
    'intimacy': char.intimacy,
    # ... 其他属性
}
can_evolve, next_stage, stage_info = EvolutionSystem.check_evolution(char_dict)

# 方案B: 修改EvolutionSystem (更好)
@staticmethod
def check_evolution(character) -> Tuple[bool, Optional[int], Optional[Dict]]:
    """检查是否满足进化条件（支持字典或模型对象）"""
    # 兼容性处理
    if hasattr(character, '__dict__'):
        # Peewee模型对象
        char_dict = character.__data__
    else:
        # 字典
        char_dict = character

    current_stage = char_dict.get("evolution_stage", 1)
    # ... 后续逻辑
```

**优先级**: 中
**工作量**: 1小时

### 3. 增加心情系统说明文档

**问题**:
心情锁定动作很棒，但玩家可能不知道如何触发

**现状**:
- 10个心情锁定动作
- 触发条件不明确
- 缺少帮助说明

**建议**:
在 `/帮助` 命令中添加"心情系统"分类：

```python
# status_commands.py 的 _show_actions_help 中添加

💭 【心情状态系统】

心情状态会影响她的反应，某些特殊动作只在特定心情下可用：

🔥 发情期 (兴奋≥80)
  • /索求 - 特殊动作

💤 贤者时间 (兴奋<20, 刚高潮后)
  • /温存 - 温柔陪伴

💫 敏感期 (羞耻<30, 兴奋>60)
  • /挑逗敏感点 - 增强刺激

😈 堕落 (堕落≥70)
  • /羞辱play - 羞辱调教

🙇 顺从 (顺从≥70)
  • /支配 - 完全支配

💡 提示: 使用 /看 查看当前心情状态
```

**优先级**: 中-高
**工作量**: 1小时

### 4. 在 `/看` 命令中显示当前心情

**问题**:
玩家无法直观看到当前心情状态

**建议**:
在状态显示中添加心情信息：

```python
# status_commands.py 中的状态显示

📊 【角色状态】

💭 当前心情: 发情期 🔥
  (身体敏感度极高，渴望更多...)

⭐ 阶段: Stage 3/5 - 亲密
💰 爱心币: 450
📅 游戏日: 第15天/42天
...
```

**优先级**: 高
**工作量**: 1小时

---

## 🟢 P2 - 建议优化 (提升品质)

### 1. 扩展时间加成系统

**现状**:
只有3个动作有 `time_bonus`：
- 早安 (6-10点, 1.5倍)
- 晚安 (22-2点, 1.5倍)
- 看星星 (20-24点, 1.5倍)

**建议**:
扩展到更多动作，增加策略深度：

```json
"约会": {
  "time_bonus": {
    "condition": "weekend",  // 周末加成
    "bonus_multiplier": 1.3
  }
},
"洗澡": {
  "time_bonus": {
    "condition": "19-23",  // 晚上洗澡
    "bonus_multiplier": 1.5
  }
},
"做饭": {
  "time_bonus": {
    "condition": "17-20",  // 晚餐时间
    "bonus_multiplier": 1.2
  }
}
```

**优先级**: 低-中
**工作量**: 2小时

### 2. 添加服装/道具解锁提示

**问题**:
玩家可能不知道某个服装的解锁条件

**建议**:
在 `/服装列表` 中显示未解锁服装的条件：

```python
# 当前显示
📦 【服装列表】
已拥有:
  ✅ 日常便装
  ✅ 学生制服

# 改进后显示
📦 【服装列表】

✅ 已拥有 (2/7):
  • 日常便装
  • 学生制服

🔒 未解锁 (5/7):
  • 性感连衣裙
    解锁条件: 亲密度≥50
    当前进度: 亲密度 30/50 ⚠️ 还差20

  • 兔女郎装
    解锁条件: 堕落度≥40
    当前进度: 堕落度 0/40 ⚠️ 还差40

  • 情趣内衣 🔥
    解锁条件: 堕落≥60, 羞耻<40
    当前进度:
      - 堕落度 0/60 ⚠️
      - 羞耻心 100/40 ❌ 太高了
```

**优先级**: 中
**工作量**: 2小时

### 3. 优化确认系统

**问题**:
11个高强度动作都需要确认，可能影响流畅度

**建议**:
添加"信任模式"选项：

```python
# 新增配置
/设置 确认模式 <开/关>

开启后：
  - 高强度动作需要确认（安全）

关闭后：
  - 不再确认，直接执行（流畅）
  - 首次关闭时给予警告

或者添加"记住我的选择"：

⚠️ 【高强度动作确认】
动作: 推倒
强度: 🔥🔥🔥🔥🔥🔥🔥🔥 (8/10)

  • 输入 /推倒 确认 继续
  • 60秒内不确认将自动取消

☑️ 记住选择，以后不再询问 (/记住确认)
```

**优先级**: 中
**工作量**: 3小时

### 4. 导出存档优化

**问题**:
存档码很长，分段显示可能导致用户复制错误

**建议方案**:

**方案A**: 提供二维码选项
```python
📦 【存档导出成功】

方式1: 文本存档码 (/导出 文本)
方式2: 二维码 (/导出 二维码) 📱
方式3: 文件导出 (/导出 文件)

当前使用: 文本存档码
存档码（共3段）...
```

**方案B**: 自动保存到文件
```python
📦 【存档导出成功】

✅ 存档已保存到文件:
   ~/desire_theatre_save_20251019_153045.txt

💾 你也可以复制存档码:
   [显示存档码...]

📥 导入方法:
   /导入 文件 <文件路径>
   或
   /导入 <存档码>
```

**优先级**: 低
**工作量**: 3小时

### 5. 添加命令别名提示

**问题**:
用户可能输入错误命令

**建议**:
当命令不存在时，提供相似命令建议：

```python
# 当前
❌ 未找到命令: 快速看

# 改进后
❌ 未找到命令: 快速看

💡 你是不是想输入:
  • /快看 - 快速查看核心属性
  • /看 - 查看详细状态

📚 输入 /帮助 查看所有命令
```

使用模糊匹配算法(如 Levenshtein Distance)

**优先级**: 低
**工作量**: 2小时

---

## 🔵 P3 - 长期优化 (锦上添花)

### 1. 日常动作累计奖励系统

**问题**:
日常温柔动作(+2~5属性)价值感不足

**建议**:
添加"习惯养成"系统：

```python
连续使用同一动作奖励:
  - 连续3天使用"早安": 额外 +2 好感
  - 连续7天使用"早安": 额外 +5 好感, 解锁特殊记忆
  - 连续14天使用"早安": 额外 +10 好感, 触发特殊事件

显示:
  ☀️ 【早安】
  效果: 好感+5, 信任+3

  🔥 连续3天! 额外 +2 好感
  💡 再坚持4天可获得特殊奖励
```

**优先级**: 低
**工作量**: 4小时

### 2. 增加中期过渡内容

**问题**:
从初期到高级动作可能有断档感

**建议**:
- 添加更多corruption 20-40 区间的动作
- 设计"觉醒"类事件，加速中期进度
- 提供"引导任务"系统

**优先级**: 低
**工作量**: 6小时

### 3. 成就系统反馈增强

**问题**:
成就解锁可能不够明显

**建议**:
```python
🏆 【成就解锁！】

"初次接触"
完成首次亲密互动

奖励:
  • 爱心币 +50
  • 解锁特殊服装: 情侣装
  • 好感度 +5

已解锁成就: 5/50
输入 /成就 查看详情
```

**优先级**: 低
**工作量**: 3小时

### 4. 统计报告功能

**建议**:
添加 `/统计` 命令，显示游戏数据：

```python
📊 【游戏统计】

⏱️ 游戏时长: 15天 (已过35.7%)

📈 互动统计:
  • 总互动次数: 68次
  • 温柔互动: 45次 (66%)
  • 堕落互动: 15次 (22%)
  • 风险互动: 3次 (4%)
  • 成功率: 95% (3次失败)

💕 属性成长:
  • 好感度: 0→85 (+85)
  • 堕落度: 0→45 (+45)
  • 最快成长: 好感度 (+5.7/天)

🎯 里程碑:
  ✅ 第一次牵手 (第2天)
  ✅ 第一次接吻 (第7天)
  ✅ 进化到阶段2 (第10天)
  ✅ 堕落度突破30 (第13天)

🏆 成就: 8/50
```

**优先级**: 低
**工作量**: 4小时

---

## 📊 优化优先级汇总

### 立即处理 (1-2天)

| 项目 | 优先级 | 工作量 | 影响 |
|------|--------|--------|------|
| 系统动作添加base_intensity | P0 | 10分钟 | 配置一致性 |
| 职业收入配置检查 | P1 | 30分钟 | 经济系统 |
| 心情系统说明 | P1 | 1小时 | 用户体验 |
| 在/看中显示心情 | P1 | 1小时 | 可见性 |

**总工作量**: 约3小时

### 短期优化 (1周内)

| 项目 | 优先级 | 工作量 | 影响 |
|------|--------|--------|------|
| 修复温柔路线API | P1 | 1小时 | 完整性 |
| 服装解锁提示 | P2 | 2小时 | 用户体验 |
| 优化确认系统 | P2 | 3小时 | 流畅度 |
| 扩展时间加成 | P2 | 2小时 | 策略深度 |

**总工作量**: 约8小时

### 中长期优化 (持续)

| 项目 | 优先级 | 工作量 | 影响 |
|------|--------|--------|------|
| 导出存档优化 | P2 | 3小时 | 便利性 |
| 命令别名提示 | P2 | 2小时 | 容错性 |
| 日常动作奖励 | P3 | 4小时 | 游戏性 |
| 成就反馈增强 | P3 | 3小时 | 反馈感 |
| 统计报告功能 | P3 | 4小时 | 数据可视化 |

**总工作量**: 约16小时

---

## 🎯 推荐优化路线

### 最小可行优化 (MVP)

**只处理P0+关键P1** - 约3小时
```
✅ 系统动作添加base_intensity (10分钟)
✅ 检查职业收入配置 (30分钟)
✅ 添加心情系统说明 (1小时)
✅ 在/看中显示心情 (1小时)
```

**收益**:
- 修复配置问题
- 显著提升用户体验
- 解决最主要的困惑点

### 标准优化 (推荐)

**P0 + P1 全部** - 约6小时
```
上述MVP内容 +
✅ 修复温柔路线API兼容性 (1小时)
✅ 添加服装解锁提示 (2小时)
```

**收益**:
- 完整功能覆盖
- 显著改善用户体验
- 消除所有P1问题

### 完整优化 (理想)

**P0 + P1 + 关键P2** - 约15小时
```
上述标准内容 +
✅ 优化确认系统 (3小时)
✅ 扩展时间加成系统 (2小时)
✅ 导出存档优化 (3小时)
✅ 命令别名提示 (2小时)
```

**收益**:
- 功能完善
- 用户体验一流
- 达到商业产品标准

---

## 💡 快速胜利 (Quick Wins)

这些优化简单但效果明显：

1. **系统动作添加base_intensity** ⏱️ 10分钟
   - 影响: 配置一致性
   - ROI: 极高

2. **在/看中显示当前心情** ⏱️ 1小时
   - 影响: 立即改善可见性
   - ROI: 高

3. **添加心情系统帮助** ⏱️ 1小时
   - 影响: 消除困惑
   - ROI: 高

**总计**: 2小时10分钟即可获得显著改善！

---

## 📝 总结建议

### 如果你只有2小时

做这3个:
1. ✅ 系统动作添加base_intensity (10分钟)
2. ✅ 在/看中显示心情 (1小时)
3. ✅ 添加心情系统说明 (1小时)

### 如果你有6小时

再加这3个:
4. ✅ 检查职业收入 (30分钟)
5. ✅ 修复温柔路线API (1小时)
6. ✅ 添加服装解锁提示 (2小时)

### 如果你有充足时间

继续添加P2级别的优化，打磨产品体验。

---

**注**: 所有工作量估算基于单人开发，实际可能有所不同。

**优先级说明**:
- P0: 必须修复（阻塞/功能性问题）
- P1: 强烈建议（显著影响用户体验）
- P2: 建议优化（提升品质）
- P3: 锦上添花（长期改进）
