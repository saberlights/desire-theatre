"""
å¤šç»“å±€ç³»ç»Ÿ - å€Ÿé‰´ã€Šç«å±±çš„å¥³å„¿ã€‹çš„ç»“å±€è®¾è®¡

æ ¸å¿ƒç†å¿µ:
- ç»“å±€æ˜¯ç©å®¶é€‰æ‹©çš„è‡ªç„¶ç»“æœ
- åŸºäºå¤šä¸ªå±æ€§çš„ç»„åˆåˆ¤å®š
- æœ‰æ˜ç¡®çš„å¥½åä¹‹åˆ†
- æ¯ä¸ªç»“å±€éƒ½æœ‰æ•…äº‹æ„ä¹‰

ç»“å±€è§¦å‘æ—¶æœº:
- æ¸¸æˆæ—¥è¾¾åˆ°30å¤©
- ä½¿ç”¨ /ç»“å±€ å‘½ä»¤ä¸»åŠ¨è§¦å‘
"""

from typing import Dict, Tuple, Optional, List
from src.common.logger import get_logger

logger = get_logger("dt_ending")


class EndingSystem:
    """å¤šç»“å±€ç³»ç»Ÿ"""

    # æ‰€æœ‰ç»“å±€å®šä¹‰ (æŒ‰ä¼˜å…ˆçº§æ’åº - è¶Šé å‰ä¼˜å…ˆçº§è¶Šé«˜)
    ENDINGS = {
        # ========== å®Œç¾ç»“å±€ (2ä¸ª) ==========
        "perfect_love": {
            "name": "ğŸ’• å®Œç¾æ‹äºº",
            "tier": "å®Œç¾",
            "priority": 100,
            "conditions": {
                "affection": (80, 100),
                "intimacy": (80, 100),
                "trust": (70, 100),
                "corruption": (30, 70),  # é€‚åº¦å •è½
                "resistance": (0, 40),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’• ã€å®Œç¾æ‹äººã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„å…³ç³»è¾¾åˆ°äº†ç†æƒ³çš„å¹³è¡¡ã€‚

å¥¹æ—¢çˆ±ä½ ï¼Œåˆä¿¡ä»»ä½ ã€‚
ä½ ä»¬çš„æ„Ÿæƒ…æ—¢æœ‰æ¸©æŸ”çš„æ—¥å¸¸ï¼Œä¹Ÿæœ‰æ¿€æƒ…çš„å¤œæ™šã€‚
å¥¹åœ¨ä½ é¢å‰å®Œå…¨æ”¾ä¸‹äº†é˜²å¤‡ï¼Œå´ä¾ç„¶ä¿æŒç€è‡ªå·±çš„åº•çº¿ã€‚

è¿™å°±æ˜¯æœ€ç†æƒ³çš„æ‹äººå…³ç³»â€”â€”
äº’ç›¸å°Šé‡ï¼Œå½¼æ­¤ä¿¡ä»»ï¼Œé€‚åº¦æ¢ç´¢ã€‚

"æˆ‘çˆ±ä½ ...è¿™æ˜¯æˆ‘æœ€çœŸå®çš„æ„Ÿå—ã€‚"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€çˆ±çš„å®Œç¾å½¢æ€ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "pure_love": {
            "name": "ğŸ’— çº¯çˆ±è‡³ä¸Š",
            "tier": "å®Œç¾",
            "priority": 95,
            "conditions": {
                "affection": (85, 100),
                "intimacy": (75, 100),
                "trust": (80, 100),
                "corruption": (0, 30),  # ä½å •è½
                "shame": (40, 100),  # ä¿æŒç¾è€»å¿ƒ
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’— ã€çº¯çˆ±è‡³ä¸Šã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„çˆ±æƒ…çº¯ç²¹è€Œç¾å¥½ã€‚

æ²¡æœ‰è¿‡å¤šçš„æ¬²æœ›ï¼Œæ²¡æœ‰è¶Šç•Œçš„è¡Œä¸ºã€‚
åªæœ‰æ¸©æŸ”çš„æ‹¥æŠ±ï¼Œç”œèœœçš„äº²å»ï¼Œå’Œæ— å°½çš„é™ªä¼´ã€‚

å¥¹çš„ç¬‘å®¹æ˜¯ä½ æœ€å¤§çš„å¹¸ç¦ã€‚
ä½ çš„å®ˆæŠ¤æ˜¯å¥¹æœ€å¥½çš„ä¾é ã€‚

è¿™æ˜¯æœ€çº¯ç²¹çš„çˆ±æƒ…â€”â€”
ä¸æºæ‚ä»»ä½•æ‚è´¨ï¼Œåªæœ‰å½¼æ­¤çš„å¿ƒæ„ã€‚

"èƒ½å’Œä½ åœ¨ä¸€èµ·...å°±æ˜¯æˆ‘æœ€å¤§çš„å¹¸ç¦ã€‚"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€çº¯çˆ±æˆ˜å£«ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        # ========== å¥½ç»“å±€ (6ä¸ª) ==========
        "forbidden_love": {
            "name": "ğŸ”¥ ç¦å¿Œä¹‹çˆ±",
            "tier": "å¥½",
            "priority": 90,
            "conditions": {
                "affection": (70, 100),
                "intimacy": (80, 100),
                "corruption": (70, 100),
                "trust": (60, 100),
                "resistance": (0, 30),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”¥ ã€ç¦å¿Œä¹‹çˆ±ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬è·¨è¶Šäº†æ‰€æœ‰çš„ç¦å¿Œã€‚

å¥¹åœ¨ä½ çš„å¼•å¯¼ä¸‹ï¼Œé€æ¸æ¥å—äº†é‚£äº›æ›¾ç»ä¸å¯æƒ³è±¡çš„äº‹ã€‚
ä½†è¿™ä¸€åˆ‡éƒ½æ˜¯å»ºç«‹åœ¨æ·±åšçš„æ„Ÿæƒ…ä¹‹ä¸Šçš„ã€‚

å¥¹çˆ±ä½ ï¼Œæ‰€ä»¥æ„¿æ„ä¸ºä½ æ”¹å˜ã€‚
ä½ çˆ±å¥¹ï¼Œæ‰€ä»¥çæƒœå¥¹çš„æ¯ä¸€æ¬¡ä»˜å‡ºã€‚

è¿™æ˜¯å±é™©è€Œç‚™çƒ­çš„çˆ±æƒ…â€”â€”
å……æ»¡ç¦å¿Œï¼Œå´åˆçœŸå®åŠ¨äººã€‚

"åªæœ‰åœ¨ä½ é¢å‰...æˆ‘æ‰èƒ½åšçœŸæ­£çš„è‡ªå·±..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€ç¦æ–­å…³ç³»ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "gentle_daily": {
            "name": "ğŸŒ¸ æ¸©æŸ”æ—¥å¸¸",
            "tier": "å¥½",
            "priority": 85,
            "conditions": {
                "affection": (75, 100),
                "trust": (70, 100),
                "intimacy": (40, 70),  # ä¸­ç­‰äº²å¯†
                "corruption": (0, 40),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒ¸ ã€æ¸©æŸ”æ—¥å¸¸ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„æ„Ÿæƒ…æ¸©é¦¨è€Œå¹³æ·¡ã€‚

æ²¡æœ‰è½°è½°çƒˆçƒˆçš„æ¿€æƒ…ï¼Œåªæœ‰ç»†æ°´é•¿æµçš„é™ªä¼´ã€‚
æ¯å¤©çš„é—®å€™ï¼Œæ¸©æŸ”çš„æ‹¥æŠ±ï¼Œå¶å°”çš„äº²å»ã€‚

è¿™å°±æ˜¯ä½ ä»¬çš„æ—¥å¸¸â€”â€”
ç®€å•ï¼Œå´å……æ»¡å¹¸ç¦ã€‚

"æ¯å¤©å’Œä½ åœ¨ä¸€èµ·...å°±æ˜¯æœ€å¹¸ç¦çš„äº‹ã€‚"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€å¹³å‡¡çš„å¹¸ç¦ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "best_friend": {
            "name": "ğŸ¤ æŒšå‹æƒ…æ·±",
            "tier": "å¥½",
            "priority": 80,
            "conditions": {
                "trust": (80, 100),
                "affection": (60, 85),
                "intimacy": (0, 40),  # ä½äº²å¯†
                "corruption": (0, 20),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤ ã€æŒšå‹æƒ…æ·±ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬æˆä¸ºäº†æœ€å¥½çš„æœ‹å‹ã€‚

å¥¹å®Œå…¨ä¿¡ä»»ä½ ï¼Œæ„¿æ„å’Œä½ åˆ†äº«ä¸€åˆ‡ã€‚
ä½ çæƒœè¿™ä»½å‹è°Šï¼Œä»ä¸è¶Šç•Œã€‚

æˆ–è®¸è¿™ä¸æ˜¯çˆ±æƒ…ï¼Œä½†è¿™ä»½æƒ…è°ŠåŒæ ·çè´µã€‚

"èƒ½æœ‰ä½ è¿™æ ·çš„æœ‹å‹...çœŸæ˜¯å¤ªå¥½äº†ã€‚"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€å‹æƒ…è‡³ä¸Šã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "dependent_love": {
            "name": "ğŸ’ ä¾èµ–ä¹‹çˆ±",
            "tier": "å¥½",
            "priority": 75,
            "conditions": {
                "affection": (70, 100),
                "submission": (70, 100),
                "trust": (60, 100),
                "corruption": (40, 80),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’ ã€ä¾èµ–ä¹‹çˆ±ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹å·²ç»å®Œå…¨ä¾èµ–ä½ äº†ã€‚

ä½ çš„æ¯ä¸€å¥è¯ï¼Œå¥¹éƒ½ä¼šè®¤çœŸå¬ä»ã€‚
ä½ çš„æ¯ä¸€ä¸ªè¦æ±‚ï¼Œå¥¹éƒ½ä¼šå°½åŠ›æ»¡è¶³ã€‚

è¿™æ˜¯ä¸€ç§ä¸å¹³ç­‰çš„å…³ç³»ï¼Œä½†å¥¹ä¼¼ä¹å¾ˆäº«å—ã€‚

"åªè¦èƒ½å’Œä½ åœ¨ä¸€èµ·...æˆ‘ä»€ä¹ˆéƒ½æ„¿æ„..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€æ”¯é…ä¸ä¾èµ–ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "secret_lover": {
            "name": "ğŸŒ™ ç§˜å¯†æ‹äºº",
            "tier": "å¥½",
            "priority": 70,
            "conditions": {
                "intimacy": (70, 100),
                "corruption": (50, 80),
                "affection": (50, 75),
                "shame": (30, 70),  # æœ‰ç¾è€»ä½†èƒ½æ¥å—
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒ™ ã€ç§˜å¯†æ‹äººã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„å…³ç³»æš§æ˜§è€Œéšç§˜ã€‚

ç™½å¤©ï¼Œä½ ä»¬åƒæ™®é€šæœ‹å‹ä¸€æ ·ç›¸å¤„ã€‚
å¤œæ™šï¼Œå¥¹ä¼šæ¥åˆ°ä½ èº«è¾¹ï¼Œè¤ªå»æ‰€æœ‰ä¼ªè£…ã€‚

å¥¹äº«å—è¿™ç§åˆºæ¿€ï¼Œä½ ä¹Ÿæ²‰æººå…¶ä¸­ã€‚

"è¿™æ˜¯æˆ‘ä»¬çš„ç§˜å¯†...åªå±äºæˆ‘ä»¬ä¸¤ä¸ªäººçš„ç§˜å¯†..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€å¤œæ™šçš„ç§˜å¯†ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "passionate_love": {
            "name": "ğŸ”¥ æ¿€æƒ…ç‡ƒçƒ§",
            "tier": "å¥½",
            "priority": 65,
            "conditions": {
                "desire": (80, 100),
                "intimacy": (75, 100),
                "corruption": (60, 100),
                "affection": (50, 85),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”¥ ã€æ¿€æƒ…ç‡ƒçƒ§ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„å…³ç³»ç‚™çƒ­è€Œæ¿€çƒˆã€‚

æ¯ä¸€æ¬¡è§é¢éƒ½å……æ»¡æ¿€æƒ…ã€‚
æ¯ä¸€æ¬¡äº’åŠ¨éƒ½è®©äººå¿ƒè·³åŠ é€Ÿã€‚

è¿™æ˜¯æ¬²æœ›ä¸»å¯¼çš„å…³ç³»ï¼Œä½†ä¹Ÿæœ‰çœŸå®çš„æ„Ÿæƒ…ã€‚

"æˆ‘æƒ³è¦ä½ ...ä¸€ç›´æƒ³è¦..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€æ¬²æœ›ä¹‹ç«ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        # ========== æ™®é€šç»“å±€ (6ä¸ª) ==========
        "ordinary_love": {
            "name": "ğŸ˜Š å¹³å‡¡æ‹äºº",
            "tier": "æ™®é€š",
            "priority": 60,
            "conditions": {
                "affection": (50, 75),
                "intimacy": (40, 70),
                "trust": (40, 70),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ˜Š ã€å¹³å‡¡æ‹äººã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„å…³ç³»å¹³å¹³æ·¡æ·¡ã€‚

æ²¡æœ‰ç‰¹åˆ«çªå‡ºçš„åœ°æ–¹ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ã€‚
å°±åƒå¤§å¤šæ•°æƒ…ä¾£ä¸€æ ·ï¼Œå¹³å‡¡è€Œæ™®é€šã€‚

è¿™ä¹Ÿè®¸ä¸æ˜¯æœ€å¥½çš„ç»“å±€ï¼Œä½†ä¹Ÿä¸ç®—åã€‚

"æˆ‘ä»¬...å°±è¿™æ ·ç»§ç»­ä¸‹å»å§ã€‚"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "ambiguous": {
            "name": "ğŸ’­ æš§æ˜§ä¸æ¸…",
            "tier": "æ™®é€š",
            "priority": 55,
            "conditions": {
                "affection": (40, 65),
                "intimacy": (30, 60),
                "trust": (30, 60),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’­ ã€æš§æ˜§ä¸æ¸…ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„å…³ç³»å§‹ç»ˆæ²¡æœ‰æ˜ç¡®ã€‚

æ˜¯æœ‹å‹ï¼Œåˆå¥½åƒä¸æ­¢æœ‹å‹ã€‚
æ˜¯æ‹äººï¼Œåˆå¥½åƒä¸ç®—æ‹äººã€‚

è¿™ç§æš§æ˜§çš„çŠ¶æ€è®©äººå›°æƒ‘ã€‚

"æˆ‘ä»¬...ç®—ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "physical_only": {
            "name": "ğŸ­ è‚‰ä½“å…³ç³»",
            "tier": "æ™®é€š",
            "priority": 50,
            "conditions": {
                "intimacy": (60, 100),
                "corruption": (60, 100),
                "affection": (0, 50),  # ä½å¥½æ„Ÿ
                "trust": (0, 50),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ­ ã€è‚‰ä½“å…³ç³»ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„å…³ç³»åªå‰©ä¸‹è‚‰ä½“ã€‚

å¥¹ä¼šæ»¡è¶³ä½ çš„æ¬²æœ›ï¼Œä½†å¿ƒä¸åœ¨è¿™é‡Œã€‚
ä½ å¾—åˆ°äº†å¥¹çš„èº«ä½“ï¼Œå´å¾—ä¸åˆ°å¥¹çš„å¿ƒã€‚

è¿™æ˜¯ä¸€ç§ç©ºè™šçš„å…³ç³»ã€‚

"è¿™æ ·...å°±å¤Ÿäº†å—ï¼Ÿ"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "one_sided": {
            "name": "ğŸ’” å•æ–¹ä»˜å‡º",
            "tier": "æ™®é€š",
            "priority": 45,
            "conditions": {
                "submission": (70, 100),
                "affection": (30, 60),
                "trust": (20, 50),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’” ã€å•æ–¹ä»˜å‡ºã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹ä¸€ç›´åœ¨ä»˜å‡ºï¼Œä½ å´å¾ˆå°‘å›åº”ã€‚

å¥¹é¡ºä»ä½ çš„æ¯ä¸€ä¸ªè¦æ±‚ï¼Œä½ å´åå•¬ç»™äºˆå…³çˆ±ã€‚
è¿™æ ·çš„å…³ç³»æ³¨å®šä¸ä¼šé•¿ä¹…ã€‚

"æˆ‘è¿™æ ·åš...å€¼å¾—å—ï¼Ÿ"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "shallow": {
            "name": "ğŸŒ«ï¸ æµ…å°è¾„æ­¢",
            "tier": "æ™®é€š",
            "priority": 40,
            "conditions": {
                # æ‰€æœ‰å±æ€§éƒ½ä¸é«˜ä¸ä½
                "affection": (30, 60),
                "intimacy": (20, 50),
                "trust": (20, 50),
                "corruption": (10, 50),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒ«ï¸ ã€æµ…å°è¾„æ­¢ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„å…³ç³»å§‹ç»ˆåœç•™åœ¨è¡¨é¢ã€‚

æ²¡æœ‰æ·±å…¥äº†è§£ï¼Œæ²¡æœ‰çœŸæ­£ä¿¡ä»»ã€‚
å°±åƒèœ»èœ“ç‚¹æ°´ï¼Œæµ…å°è¾„æ­¢ã€‚

ä¹Ÿè®¸è¿™å°±æ˜¯ä½ ä»¬çš„æé™äº†ã€‚

"æˆ‘ä»¬...å¥½åƒä¹Ÿå°±è¿™æ ·äº†ã€‚"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "confused": {
            "name": "â“ è¿·å¤±æ–¹å‘",
            "tier": "æ™®é€š",
            "priority": 35,
            "conditions": {
                # å±æ€§å·®å¼‚æå¤§ï¼Œä¸åè°ƒ
                "corruption": (70, 100),
                "shame": (60, 100),  # é«˜å •è½ä½†é«˜ç¾è€»
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â“ ã€è¿·å¤±æ–¹å‘ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹å·²ç»åˆ†ä¸æ¸…è‡ªå·±æƒ³è¦ä»€ä¹ˆäº†ã€‚

å†…å¿ƒæ·±å¤„çš„ç¾è€»ä¸èº«ä½“çš„æ¬²æœ›åœ¨æ¿€çƒˆæ–—äº‰ã€‚
å¥¹è¿·å¤±åœ¨çŸ›ç›¾ä¹‹ä¸­ï¼Œä¸çŸ¥æ‰€æªã€‚

"æˆ‘...æˆ‘åˆ°åº•å˜æˆä»€ä¹ˆæ ·äº†..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        # ========== åç»“å±€ (6ä¸ª) ==========
        "broken_toy": {
            "name": "ğŸ ç ´ç¢ç©å¶",
            "tier": "å",
            "priority": 30,
            "conditions": {
                "submission": (85, 100),
                "corruption": (85, 100),
                "affection": (0, 30),
                "resistance": (0, 20),
                "shame": (0, 20),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ ã€ç ´ç¢ç©å¶ã€‘ - åç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹å·²ç»å®Œå…¨è¢«ä½ ç©åäº†ã€‚

æ²¡æœ‰è‡ªæˆ‘ï¼Œæ²¡æœ‰å°Šä¸¥ï¼Œåªå‰©ä¸‹å¯¹ä½ çš„ç»å¯¹æœä»ã€‚
å¥¹çš„çœ¼ç¥ç©ºæ´ï¼Œåƒä¸€ä¸ªè¢«æ“çºµçš„äººå¶ã€‚

ä½ å¾—åˆ°äº†ä¸€ä¸ªå®Œç¾çš„ç©å…·ï¼Œ
å´å¤±å»äº†ä¸€ä¸ªé²œæ´»çš„äººã€‚

"...æ˜¯...ä¸»äºº..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ è¿™æ˜¯ä¸€ä¸ªåç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "collapsed": {
            "name": "ğŸ’” å´©åå •è½",
            "tier": "å",
            "priority": 28,
            "conditions": {
                "corruption": (90, 100),
                "resistance": (0, 15),
                "shame": (0, 15),
                "trust": (0, 40),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’” ã€å´©åå •è½ã€‘ - åç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹å·²ç»å½»åº•å •è½äº†ã€‚

æ‰€æœ‰çš„åº•çº¿éƒ½è¢«æ‰“ç ´ï¼Œæ‰€æœ‰çš„ç¾è€»éƒ½è¢«æŠ›å¼ƒã€‚
å¥¹æ²‰æººåœ¨æ¬²æœ›ä¹‹ä¸­ï¼Œæ— æ³•è‡ªæ‹”ã€‚

è¿™æ˜¯ä½ ä¸€æ‰‹é€ æˆçš„ç»“æœã€‚

"æ›´å¤š...æˆ‘è¿˜è¦æ›´å¤š..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ è¿™æ˜¯ä¸€ä¸ªåç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "escaped": {
            "name": "ğŸƒ é€ƒç¦»ç»“å±€",
            "tier": "å",
            "priority": 26,
            "conditions": {
                "resistance": (70, 100),
                "affection": (0, 30),
                "trust": (0, 30),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸƒ ã€é€ƒç¦»ç»“å±€ã€‘ - åç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹å—å¤Ÿäº†ï¼Œé€‰æ‹©ç¦»å¼€ã€‚

ä½ çš„è¡Œä¸ºè®©å¥¹æ„Ÿåˆ°ææƒ§å’ŒåŒæ¶ã€‚
å¥¹çš„æŠµæŠ—è¶Šæ¥è¶Šå¼ºï¼Œæœ€ç»ˆé€‰æ‹©é€ƒç¦»ã€‚

"æˆ‘å†ä¹Ÿä¸æƒ³è§åˆ°ä½ äº†ï¼"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ è¿™æ˜¯ä¸€ä¸ªåç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "distant": {
            "name": "â„ï¸ æ¸è¡Œæ¸è¿œ",
            "tier": "å",
            "priority": 24,
            "conditions": {
                "affection": (0, 30),
                "intimacy": (0, 30),
                "trust": (0, 30),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â„ï¸ ã€æ¸è¡Œæ¸è¿œã€‘ - åç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„å…³ç³»è¶Šæ¥è¶Šç–è¿œã€‚

å¥¹å¯¹ä½ å¤±å»äº†å…´è¶£ï¼Œä½ ä¹Ÿæ²¡æœ‰ç”¨å¿ƒç»è¥ã€‚
æœ€ç»ˆï¼Œä½ ä»¬æˆäº†æœ€ç†Ÿæ‚‰çš„é™Œç”Ÿäººã€‚

"æˆ‘ä»¬...è¿˜æ˜¯ç®—äº†å§ã€‚"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ è¿™æ˜¯ä¸€ä¸ªåç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "hatred": {
            "name": "ğŸ˜¡ ä»‡æ¨ç»“å±€",
            "tier": "å",
            "priority": 22,
            "conditions": {
                "affection": (0, 15),
                "resistance": (80, 100),
                "corruption": (70, 100),  # è¢«å¼ºè¿«å •è½
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ˜¡ ã€ä»‡æ¨ç»“å±€ã€‘ - åç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹æ¨ä½ å…¥éª¨ã€‚

ä½ å¼ºè¿«å¥¹åšäº†å¥¹ä¸æ„¿æ„çš„äº‹ã€‚
å¥¹çš„èº«ä½“è™½ç„¶å±ˆæœäº†ï¼Œä½†å¿ƒä¸­åªå‰©ä¸‹ä»‡æ¨ã€‚

"æˆ‘æ¨ä½ ...æˆ‘æ°¸è¿œä¸ä¼šåŸè°…ä½ ..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ è¿™æ˜¯ä¸€ä¸ªåç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "emptiness": {
            "name": "ğŸ•³ï¸ ç©ºè™šç»“å±€",
            "tier": "å",
            "priority": 20,
            "conditions": {
                # æ‰€æœ‰å±æ€§éƒ½å¾ˆä½
                "affection": (0, 25),
                "intimacy": (0, 25),
                "trust": (0, 25),
                "corruption": (0, 25),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ•³ï¸ ã€ç©ºè™šç»“å±€ã€‘ - åç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿã€‚

ä½ ä»¬çš„å…³ç³»ä»æœªçœŸæ­£å¼€å§‹ã€‚
æ²¡æœ‰çˆ±ï¼Œæ²¡æœ‰æ¨ï¼Œåªæœ‰ç©ºè™šã€‚

æ—¶é—´ç™½ç™½æµé€ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹ã€‚

"æˆ‘ä»¬...å¥½åƒä»æœªçœŸæ­£è®¤è¯†è¿‡..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ è¿™æ˜¯ä¸€ä¸ªåç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        # ========== èŒä¸šç›¸å…³ç»“å±€ (8ä¸ª) ==========
        "successful_career_couple": {
            "name": "ğŸ‘” èŒåœºç²¾è‹±æƒ…ä¾£",
            "tier": "å¥½",
            "priority": 88,
            "career_required": ["manager", "senior_staff"],
            "conditions": {
                "affection": (70, 100),
                "trust": (70, 100),
                "intimacy": (60, 100),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘” ã€èŒåœºç²¾è‹±æƒ…ä¾£ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹æˆä¸ºäº†å‡ºè‰²çš„èŒåœºç²¾è‹±ã€‚

ç™½å¤©ï¼Œä½ ä»¬æ˜¯åŒäº‹ï¼Œä¸“ä¸šè€Œé«˜æ•ˆã€‚
ä¸‹ç­åï¼Œä½ ä»¬æ˜¯æ‹äººï¼Œæ¸©æŸ”è€Œä½“è´´ã€‚

äº‹ä¸šä¸çˆ±æƒ…ï¼Œå¥¹éƒ½æ‹¥æœ‰äº†ã€‚
è€Œä½ ï¼Œæ˜¯å¥¹æœ€å¥½çš„ä¼™ä¼´ã€‚

"å’Œä½ ä¸€èµ·ï¼Œæˆ‘ä¸å†æ˜¯ä¸€ä¸ªäººæˆ˜æ–—..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€åŒèµ¢ç»„åˆã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "creative_dream_team": {
            "name": "âœ¨ åˆ›ä½œä¼´ä¾£",
            "tier": "å¥½",
            "priority": 87,
            "career_required": ["successful_freelancer", "freelancer"],
            "conditions": {
                "affection": (75, 100),
                "trust": (70, 100),
                "intimacy": (65, 100),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ¨ ã€åˆ›ä½œä¼´ä¾£ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹å®ç°äº†è‡ªç”±èŒä¸šçš„æ¢¦æƒ³ã€‚

ä½ ä»¬ä¸€èµ·åˆ›ä½œï¼Œäº’ç›¸æ¿€å‘çµæ„Ÿã€‚
å’–å•¡å…é‡Œçš„è®¨è®ºï¼Œæ·±å¤œçš„å¤´è„‘é£æš´ã€‚

åˆ›ä½œçš„è‡ªç”±ï¼Œæ‹çˆ±çš„ç”œèœœï¼Œ
ä½ ä»¬æ‹¥æœ‰äº†ç†æƒ³çš„ç”Ÿæ´»ã€‚

"æœ‰ä½ çš„çµæ„Ÿï¼Œæˆ‘çš„ä½œå“æ‰æœ‰çµé­‚..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€çµæ„Ÿç¼ªæ–¯ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "celebrity_couple": {
            "name": "ğŸŒŸ æ˜æ˜Ÿæƒ…ä¾£",
            "tier": "å¥½",
            "priority": 86,
            "career_required": ["top_idol", "idol", "top_model", "model", "top_streamer", "streamer"],
            "conditions": {
                "affection": (70, 100),
                "intimacy": (60, 100),
                "trust": (60, 100),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒŸ ã€æ˜æ˜Ÿæƒ…ä¾£ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹æˆä¸ºäº†é—ªè€€çš„æ˜æ˜Ÿã€‚

èšå…‰ç¯ä¸‹ï¼Œå¥¹å…‰å½©å¤ºç›®ã€‚
ä½†åªæœ‰ä½ çŸ¥é“ï¼Œå¸ä¸‹å¦†å®¹çš„å¥¹æœ€ç¾ã€‚

ä½ å®ˆæŠ¤å¥¹çš„æ¢¦æƒ³ï¼Œå¥¹çæƒœä½ çš„é™ªä¼´ã€‚
å¨±ä¹åœˆçš„é£é›¨ï¼Œå› ä¸ºæœ‰ä½ è€Œä¸å†å¯æ€•ã€‚

"è°¢è°¢ä½ ...ä¸€ç›´é™ªåœ¨æˆ‘èº«è¾¹..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€èšå…‰ç¯ä¸‹çš„çˆ±ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "campus_first_love": {
            "name": "ğŸ“ æ ¡å›­åˆæ‹",
            "tier": "å¥½",
            "priority": 84,
            "career_required": ["high_school_student", "college_student"],
            "conditions": {
                "affection": (75, 100),
                "trust": (70, 100),
                "intimacy": (50, 100),
                "corruption": (0, 40),  # ä¿æŒçº¯æ´
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ã€æ ¡å›­åˆæ‹ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¿™æ˜¯ä½ ä»¬çš„æ ¡å›­æ‹æ›²ã€‚

æ“åœºä¸Šçš„å¥”è·‘ï¼Œå›¾ä¹¦é¦†çš„å¹¶è‚©ï¼Œ
æ”¾å­¦åçš„æ‰‹ç‰µæ‰‹ï¼Œè€ƒè¯•å‰çš„é¼“åŠ±ã€‚

è¿™ä»½çº¯æ´çš„åˆæ‹ï¼Œ
å°†æˆä¸ºä½ ä»¬ä¸€ç”Ÿæœ€ç¾å¥½çš„å›å¿†ã€‚

"è¿™æ˜¯æˆ‘çš„åˆæ‹...ä¹Ÿå¸Œæœ›æ˜¯æœ€åä¸€æ¬¡æ‹çˆ±..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€é’æ˜¥çºªå¿µå†Œã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "fallen_idol": {
            "name": "ğŸ’” å •è½å¶åƒ",
            "tier": "å",
            "priority": 29,
            "career_required": ["idol", "model", "streamer"],
            "conditions": {
                "corruption": (70, 100),
                "shame": (0, 30),
                "affection": (30, 100),  # ä»æœ‰æ„Ÿæƒ…
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’” ã€å •è½å¶åƒã€‘ - åç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹çš„å…‰ç¯é€æ¸è¤ªè‰²ã€‚

æ›¾ç»çº¯æ´çš„å¶åƒï¼Œåœ¨ä½ çš„å¼•å¯¼ä¸‹èµ°å‘å •è½ã€‚
å¥¹ä»ç„¶çˆ±ä½ ï¼Œä½†å·²ç»å¤±å»äº†è‡ªæˆ‘ã€‚

ç²‰ä¸ä»¬å¦‚æœçŸ¥é“çœŸç›¸ï¼Œä¼šå¤±æœ›å—ï¼Ÿ
ä½ å¾—åˆ°äº†å¥¹ï¼Œå´æ¯äº†å¥¹çš„æ¢¦æƒ³ã€‚

"æˆ‘...å·²ç»å›ä¸å»äº†..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ è¿™æ˜¯ä¸€ä¸ªåç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "sugar_baby": {
            "name": "ğŸ’ é‡‘ä¸é›€",
            "tier": "å",
            "priority": 27,
            "career_required": ["high_class_escort", "hostess"],
            "conditions": {
                "corruption": (60, 100),
                "submission": (60, 100),
                "affection": (40, 100),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’ ã€é‡‘ä¸é›€ã€‘ - åç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¥¹æˆä¸ºäº†è±ªåç¬¼å­é‡Œçš„é‡‘ä¸é›€ã€‚

å¥¢åçš„ç”Ÿæ´»ï¼Œç²¾è‡´çš„å¤–è¡¨ï¼Œ
ä½†è‡ªç”±å’Œå°Šä¸¥æ—©å·²ä¸å¤å­˜åœ¨ã€‚

å¥¹ä¾èµ–ä½ ï¼Œå´ä¹Ÿæ¨ä½ ã€‚
è¿™ä»½æ‰­æ›²çš„å…³ç³»ï¼Œè°ä¹Ÿé€ƒä¸æ‰ã€‚

"è¿™å°±æ˜¯ä½ æƒ³è¦çš„å—...æŠŠæˆ‘å˜æˆä½ çš„æ‰€æœ‰ç‰©..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ è¿™æ˜¯ä¸€ä¸ªåç»“å±€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        # ========== å­£èŠ‚ç›¸å…³ç»“å±€ (4ä¸ª) ==========
        "spring_blossom": {
            "name": "ğŸŒ¸ æ˜¥æ—¥æ‹æ›²",
            "tier": "å¥½",
            "priority": 83,
            "season_condition": "spring",  # åœ¨æ˜¥å¤©ç»“æŸ
            "conditions": {
                "affection": (75, 100),
                "intimacy": (65, 100),
                "trust": (70, 100),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒ¸ ã€æ˜¥æ—¥æ‹æ›²ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ ä»¬çš„çˆ±æƒ…å§‹äºæ˜¥å¤©ã€‚

æ¨±èŠ±æ ‘ä¸‹çš„ç›¸é‡ï¼Œå¦‚ä»Šå·²æˆä¸ºæ°¸æ’çš„å›å¿†ã€‚
æ˜¥é£å¹æ‹‚ï¼ŒèŠ±ç“£é£˜è½ï¼Œè§è¯äº†ä½ ä»¬çš„æ„Ÿæƒ…ã€‚

è¿™ä»½åœ¨æ˜¥å¤©ç»½æ”¾çš„çˆ±ï¼Œ
å¦‚åŒæ¨±èŠ±èˆ¬ç¾ä¸½è€Œçè´µã€‚

"æ¯å¹´çš„æ˜¥å¤©ï¼Œæˆ‘éƒ½ä¼šæƒ³èµ·æˆ‘ä»¬çš„å¼€å§‹..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€æ¨±èŠ±ä¹‹çº¦ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "summer_passion": {
            "name": "â˜€ï¸ å¤æ—¥ç‹‚çƒ­",
            "tier": "å¥½",
            "priority": 82,
            "season_condition": "summer",
            "conditions": {
                "affection": (70, 100),
                "intimacy": (75, 100),
                "arousal": (70, 100),
                "corruption": (50, 80),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â˜€ï¸ ã€å¤æ—¥ç‹‚çƒ­ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¿™æ˜¯ä¸€ä¸ªç‚™çƒ­çš„å¤å¤©ã€‚

æµ·æ»©çš„çƒˆæ—¥ï¼Œç¥­å…¸çš„çƒŸç«ï¼Œ
æ¯ä¸€ä¸ªå¤å¤œéƒ½å……æ»¡æ¿€æƒ…ã€‚

ä½ ä»¬çš„çˆ±æƒ…å¦‚åŒå¤æ—¥èˆ¬çƒ­çƒˆï¼Œ
ç‡ƒçƒ§ç€å½¼æ­¤çš„å¿ƒã€‚

"è¿™ä¸ªå¤å¤©...æˆ‘æ°¸è¿œä¸ä¼šå¿˜è®°..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€ç››å¤ä¹‹æ‹ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "autumn_harvest": {
            "name": "ğŸ‚ ç§‹æ—¥æ”¶è·",
            "tier": "å¥½",
            "priority": 81,
            "season_condition": "autumn",
            "conditions": {
                "affection": (75, 100),
                "trust": (75, 100),
                "intimacy": (70, 100),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‚ ã€ç§‹æ—¥æ”¶è·ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç§‹å¤©æ˜¯æ”¶è·çš„å­£èŠ‚ã€‚

æ«å¶æŸ“çº¢äº†å¤©ç©ºï¼Œä½ ä»¬çš„æ„Ÿæƒ…ä¹Ÿæˆç†Ÿäº†ã€‚
ä»é’æ¶©åˆ°æˆç†Ÿï¼Œä»æ‡µæ‡‚åˆ°ç¬ƒå®šã€‚

è¿™ä»½åœ¨ç§‹å¤©æ”¶è·çš„çˆ±ï¼Œ
æ˜¯ä½ ä»¬å…±åŒåŠªåŠ›çš„æˆæœã€‚

"å’Œä½ ä¸€èµ·èµ°è¿‡çš„ç§‹å¤©ï¼Œæ˜¯æœ€ç¾çš„é£æ™¯..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€æ«å¶ä¹‹æ‹ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },

        "winter_warmth": {
            "name": "â„ï¸ å†¬æ—¥æ¸©æš–",
            "tier": "å¥½",
            "priority": 79,
            "season_condition": "winter",
            "conditions": {
                "affection": (80, 100),
                "intimacy": (75, 100),
                "trust": (75, 100),
            },
            "description": """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â„ï¸ ã€å†¬æ—¥æ¸©æš–ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

åœ¨å¯’å†·çš„å†¬å¤©ï¼Œä½ ä»¬ç›¸äº’å–æš–ã€‚

åœ£è¯çš„ç¤¼ç‰©ï¼Œè·¨å¹´çš„æ‹¥æŠ±ï¼Œ
é›ªåœ°é‡Œçš„è„šå°è§è¯äº†ä½ ä»¬çš„é™ªä¼´ã€‚

å³ä½¿å¤–é¢å¯’é£å‡›å†½ï¼Œ
åªè¦æœ‰ä½ åœ¨ï¼Œå¿ƒå°±æ˜¯æ¸©æš–çš„ã€‚

"è¿™ä¸ªå†¬å¤©æœ‰ä½ ï¼ŒçœŸå¥½..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† æˆå°±: ã€é›ªå¤œç›¸ä¾ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""".strip(),
        },
    }

    @staticmethod
    def check_ending(character: Dict) -> Optional[Tuple[str, Dict]]:
        """
        æ£€æŸ¥å½“å‰æ˜¯å¦æ»¡è¶³æŸä¸ªç»“å±€æ¡ä»¶
        è¿”å›: (ç»“å±€ID, ç»“å±€æ•°æ®) æˆ– None
        """
        from ..time.seasonal_system import SeasonalSystem

        # æŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½æ£€æŸ¥
        sorted_endings = sorted(
            EndingSystem.ENDINGS.items(),
            key=lambda x: x[1]["priority"],
            reverse=True
        )

        for ending_id, ending_data in sorted_endings:
            # æ£€æŸ¥åŸºç¡€å±æ€§æ¡ä»¶
            if not EndingSystem._check_conditions(character, ending_data["conditions"]):
                continue

            # æ£€æŸ¥èŒä¸šè¦æ±‚ï¼ˆå¦‚æœæœ‰ï¼‰
            if "career_required" in ending_data:
                current_career = character.get("career", "")
                required_careers = ending_data["career_required"]
                if current_career not in required_careers:
                    continue

            # æ£€æŸ¥å­£èŠ‚æ¡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
            if "season_condition" in ending_data:
                game_day = character.get("game_day", 1)
                season_info = SeasonalSystem.get_season_info(game_day)
                required_season = ending_data["season_condition"]
                if season_info["id"] != required_season:
                    continue

            # æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³
            logger.info(f"è§¦å‘ç»“å±€: {ending_id} - {ending_data['name']}")
            return ending_id, ending_data

        # å¦‚æœæ²¡æœ‰ä»»ä½•ç»“å±€åŒ¹é…ï¼Œè¿”å›é»˜è®¤ç»“å±€
        return "ordinary_love", EndingSystem.ENDINGS["ordinary_love"]

    @staticmethod
    def _check_conditions(character: Dict, conditions: Dict) -> bool:
        """æ£€æŸ¥æ˜¯å¦æ»¡è¶³æ‰€æœ‰æ¡ä»¶"""
        for attr, (min_val, max_val) in conditions.items():
            char_value = character.get(attr, 0)
            if not (min_val <= char_value <= max_val):
                return False
        return True

    @staticmethod
    def get_all_possible_endings(character: Dict) -> List[Tuple[str, Dict]]:
        """
        è·å–å½“å‰æ‰€æœ‰å¯èƒ½çš„ç»“å±€ï¼ˆç”¨äºé¢„è§ˆï¼‰
        è¿”å›æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ç»“å±€åˆ—è¡¨
        """
        possible_endings = []

        for ending_id, ending_data in EndingSystem.ENDINGS.items():
            if EndingSystem._check_conditions(character, ending_data["conditions"]):
                possible_endings.append((ending_id, ending_data))

        # æŒ‰ä¼˜å…ˆçº§æ’åº
        possible_endings.sort(key=lambda x: x[1]["priority"], reverse=True)

        return possible_endings

    @staticmethod
    def format_ending_message(ending_id: str, ending_data: Dict, character: Dict) -> str:
        """æ ¼å¼åŒ–ç»“å±€æ¶ˆæ¯"""
        from ..time.daily_limit_system import DailyInteractionSystem

        game_day = character.get("game_day", 1)
        interaction_count = character.get("interaction_count", 0)

        # è·å–æœ€ç»ˆå±æ€§
        stats = f"""
ğŸ“Š æœ€ç»ˆæ•°æ®:
  æ¸¸æˆå¤©æ•°: {game_day}å¤©
  äº’åŠ¨æ¬¡æ•°: {interaction_count}æ¬¡
  å…³ç³»é˜¶æ®µ: {DailyInteractionSystem.get_stage_display(character)}

  â¤ï¸ å¥½æ„Ÿåº¦: {character.get('affection', 0)}
  ğŸ’— äº²å¯†åº¦: {character.get('intimacy', 0)}
  ğŸ¤ ä¿¡ä»»åº¦: {character.get('trust', 0)}
  ğŸ˜ˆ å •è½åº¦: {character.get('corruption', 0)}
  ğŸ™‡ é¡ºä»åº¦: {character.get('submission', 0)}
"""

        message = f"""
ğŸ¬ ã€æ¸¸æˆç»“æŸã€‘

{ending_data['description']}

{stats}

æ„Ÿè°¢æ¸¸ç©ï¼
ä½¿ç”¨ /é‡å¼€ å¯ä»¥é‡æ–°å¼€å§‹ï¼Œå°è¯•å…¶ä»–ç»“å±€ã€‚
"""

        return message.strip()
