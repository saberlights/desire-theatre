"""
快速参考命令 - 提供简化的命令速查卡
"""

import re
from typing import Tuple

from src.plugin_system import BaseCommand


class DTQuickReferenceCommand(BaseCommand):
    """快速参考命令 - 生成简化的命令速查卡"""

    command_name = "dt_quick_reference"
    command_description = "显示简化的命令速查卡"
    command_pattern = r"^/(快速参考|速查|quickref|qr)$"

    async def execute(self) -> Tuple[bool, str, bool]:
        # 尝试使用图片输出
        try:
            from ..utils.help_image_generator import HelpImageGenerator

            sections = [
                ("🎯 核心命令 (8个)", [
                    "/开始 <人格> - 创建角色 (傲娇/天真/妖媚/害羞/高冷)",
                    "/看 - 查看完整状态 | /快看 - 快速状态",
                    "/明日 - 推进到下一天",
                    "/重开 - 重置游戏",
                    "/导出 - 导出存档 | /导入 <码> - 导入存档",
                    "/快速互动 - 随机动作 | /推荐 - AI推荐",
                    "/帮助 - 完整命令 | /说明 - 游戏指南",
                    "/快速参考 - 本页"
                ]),
                ("💕 常用互动 (12个)", [
                    "温柔互动:",
                    "  /早安 /晚安 /牵手 /摸头 /抱 /聊天 <内容>",
                    "亲密互动:",
                    "  /亲 <部位> - 额头/脸颊/嘴唇/脖子",
                    "  /摸 <部位> - 头/手/腰/背",
                    "  /表白 /凝视 /诱惑"
                ]),
                ("⚙️ 系统功能 (10个)", [
                    "时间: /明日 /季节",
                    "职业: /职业 /晋升",
                    "结局: /结局 /结局预览",
                    "人格: /人格 /选择 <1-3>",
                    "服装: /服装列表 /穿 <名称>",
                    "道具: /背包 /用 <道具>",
                    "场景: /场景列表 /去 <场景>",
                    "商店: /商店 /买道具 /买服装",
                    "赚钱: /打工 <工作>",
                    "小游戏: /真心话 /大冒险 /骰子"
                ]),
                ("❓ 获取帮助", [
                    "/帮助 - 查看完整命令列表和所有功能",
                    "/说明 - 游戏玩法详细指南",
                    "/推荐 - AI推荐下一步行动",
                    "/快速互动 - 不知道做什么？让AI帮你选",
                    "",
                    "💡 括号 <> 内为必需参数，如: /穿 女仆装"
                ])
            ]

            img_bytes, img_base64 = HelpImageGenerator.generate_help_image(
                "快速参考 - 命令速查卡", sections, width=1200
            )

            await self.send_image(img_base64)
            return True, "显示快速参考", True

        except Exception as e:
            # 降级到文本模式
            import traceback
            traceback.print_exc()
            pass

        # 文本模式降级
        quick_ref_text = """
📌 【快速参考 - 命令速查卡】

━━━ 🎯 核心命令 ━━━
/开始 <人格>  创建角色 (傲娇/天真/妖媚/害羞/高冷)
/看           查看完整状态
/快看         快速查看核心属性
/明日         推进到下一天
/重开         重置游戏
/导出         导出存档
/导入 <码>    导入存档
/快速互动     随机选择动作
/推荐         AI推荐下一步
/帮助         完整命令列表
/说明         游戏指南

━━━ 💕 常用互动 ━━━
温柔互动:
  /早安 /晚安 /牵手 /摸头 /抱 /聊天 <内容>

亲密互动:
  /亲 <部位> - 额头/脸颊/嘴唇/脖子
  /摸 <部位> - 头/手/腰/背
  /表白 /凝视 /诱惑

━━━ ⚙️ 系统功能 ━━━
时间: /明日 /季节
职业: /职业 /晋升
结局: /结局 /结局预览
人格: /人格 /选择 <1-3>
服装: /服装列表 /穿 <名称>
道具: /背包 /用 <道具>
场景: /场景列表 /去 <场景>
商店: /商店 /买道具 /买服装
赚钱: /打工 <工作>
小游戏: /真心话 /大冒险 /骰子

━━━ ❓ 获取帮助 ━━━
/帮助         查看完整命令列表和所有功能
/说明         游戏玩法详细指南
/推荐         AI推荐下一步行动
/快速互动     不知道做什么？让AI帮你选

💡 括号 <> 内为必需参数，如: /穿 女仆装
💡 提示：使用 /帮助 查看完整命令列表
"""
        await self.send_text(quick_ref_text.strip())
        return True, "显示快速参考", True
