# æ’ä»¶æ¶æ„é‡æ„æ€»ç»“

**æ—¥æœŸ**: 2025-10-19
**ç‰ˆæœ¬**: v2.0
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ¯ é‡æ„ç›®æ ‡

å°†æ··ä¹±çš„å•å±‚ç›®å½•ç»“æ„é‡æ„ä¸ºæ¸…æ™°çš„æ¨¡å—åŒ–åˆ†å±‚æ¶æ„ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ğŸ“Š é‡æ„å‰åå¯¹æ¯”

### é‡æ„å‰ (v1.x)
```
desire_theatre/
â”œâ”€â”€ core/              # 35ä¸ªç³»ç»Ÿæ–‡ä»¶æ··åœ¨ä¸€èµ·
â”‚   â”œâ”€â”€ attribute_system.py
â”‚   â”œâ”€â”€ action_handler.py
â”‚   â”œâ”€â”€ career_system.py
â”‚   â”œâ”€â”€ ending_system.py
â”‚   â”œâ”€â”€ ... (30+ æ›´å¤šæ–‡ä»¶)
â”‚   â””â”€â”€ models.py
â”œâ”€â”€ extensions/        # 11ä¸ªåŠŸèƒ½æ–‡ä»¶
â”œâ”€â”€ commands/          # 16ä¸ªå‘½ä»¤æ–‡ä»¶å¹³é“º
â””â”€â”€ (æµ‹è¯•ã€æ–‡æ¡£æ··ä¹±æ•£å¸ƒ)
```

### é‡æ„å (v2.0)
```
desire_theatre/
â”œâ”€â”€ core/              # åªä¿ç•™æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ models.py
â”‚
â”œâ”€â”€ systems/           # 11ä¸ªå­ç³»ç»Ÿï¼ŒèŒè´£æ¸…æ™°
â”‚   â”œâ”€â”€ attributes/    # å±æ€§ç³»ç»Ÿ (3ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ personality/   # äººæ ¼æƒ…ç»ª (4ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ events/        # äº‹ä»¶ç³»ç»Ÿ (4ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ career/        # èŒä¸šå…»æˆ (1ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ relationship/  # å…³ç³»å‘å±• (3ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ actions/       # åŠ¨ä½œäº¤äº’ (4ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ time/          # æ—¶é—´å‘¨æœŸ (3ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ memory/        # è®°å¿†å­¦ä¹  (2ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ endings/       # ç»“å±€ç³»ç»Ÿ (2ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ scenes/        # åœºæ™¯ç³»ç»Ÿ (1ä¸ªæ–‡ä»¶)
â”‚   â””â”€â”€ mechanics/     # å…¶ä»–æœºåˆ¶ (5ä¸ªæ–‡ä»¶)
â”‚
â”œâ”€â”€ features/          # 7ä¸ªåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ shop/          # å•†åº—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ items/         # é“å…·ç³»ç»Ÿ
â”‚   â”œâ”€â”€ outfits/       # æœè£…ç³»ç»Ÿ
â”‚   â”œâ”€â”€ achievements/  # æˆå°±ç³»ç»Ÿ
â”‚   â”œâ”€â”€ scenes/        # åœºæ™¯æ‰©å±•
â”‚   â”œâ”€â”€ games/         # å°æ¸¸æˆ
â”‚   â””â”€â”€ services/      # ä»˜è´¹æœåŠ¡
â”‚
â”œâ”€â”€ commands/          # 8ä¸ªåŠŸèƒ½åˆ†ç»„
â”‚   â”œâ”€â”€ basic/         # åŸºç¡€å‘½ä»¤
â”‚   â”œâ”€â”€ actions/       # åŠ¨ä½œå‘½ä»¤
â”‚   â”œâ”€â”€ character/     # è§’è‰²å‘½ä»¤
â”‚   â”œâ”€â”€ career/        # èŒä¸šå‘½ä»¤
â”‚   â”œâ”€â”€ shop/          # å•†åº—å‘½ä»¤
â”‚   â”œâ”€â”€ social/        # ç¤¾äº¤å‘½ä»¤
â”‚   â”œâ”€â”€ endings/       # ç»“å±€å‘½ä»¤
â”‚   â””â”€â”€ extensions/    # æ‰©å±•å‘½ä»¤
â”‚
â”œâ”€â”€ utils/             # å·¥å…·ç±»
â”œâ”€â”€ tests/             # æµ‹è¯•æ–‡ä»¶
â””â”€â”€ docs/              # æ–‡æ¡£
```

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. ç›®å½•ç»“æ„é‡ç»„
- âœ… åˆ›å»ºäº† 11 ä¸ª systems å­æ¨¡å—
- âœ… åˆ›å»ºäº† 7 ä¸ª features å­æ¨¡å—
- âœ… åˆ›å»ºäº† 8 ä¸ª commands åˆ†ç»„
- âœ… åˆ›å»ºäº† tests/ å’Œ docs/ ç›®å½•

### 2. æ–‡ä»¶ç§»åŠ¨ä¸é‡ç»„
- âœ… ç§»åŠ¨äº† **35 ä¸ª** core æ–‡ä»¶åˆ° systems/
- âœ… ç§»åŠ¨äº† **11 ä¸ª** extensions æ–‡ä»¶åˆ° features/
- âœ… é‡ç»„äº† **16 ä¸ª** commands æ–‡ä»¶
- âœ… ç§»åŠ¨äº† **7 ä¸ª** æµ‹è¯•æ–‡ä»¶åˆ° tests/
- âœ… ç§»åŠ¨äº† **8 ä¸ª** æ–‡æ¡£åˆ° docs/

**æ–‡ä»¶ç§»åŠ¨æ€»æ•°**: 97 ä¸ª Python æ–‡ä»¶

### 3. Import è·¯å¾„æ›´æ–°
- âœ… æ›´æ–°äº† **30+** ä¸ªæ–‡ä»¶çš„ import è¯­å¥
- âœ… ä¿®å¤äº†ç³»ç»Ÿé—´çš„ç›¸äº’å¼•ç”¨
- âœ… ä¿®å¤äº† plugin.py çš„æ‰€æœ‰å¯¼å…¥

**å…³é”®ä¿®å¤**:
```python
# ä¿®å¤å‰
from .core.xxx import ...
from .extensions.xxx import ...

# ä¿®å¤å
from .systems.xxx.xxx import ...
from .features.xxx.xxx import ...
```

### 4. æ–‡ä»¶åˆå¹¶ä¸æ¸…ç†
- âœ… åˆå¹¶ `item_system.py` å’Œ `item_system_enhanced.py` â†’ `features/items/item_system.py`
- âœ… åˆå¹¶ `outfit_system.py` å’Œ `outfit_system_enhanced.py` â†’ `features/outfits/outfit_system.py`
- âœ… åˆ é™¤ç©ºçš„ extensions/ ç›®å½•
- âœ… æ¸…ç†æ‰€æœ‰ __pycache__

### 5. åˆ›å»ºæ–‡æ¡£
- âœ… `ARCHITECTURE.md` - å®Œæ•´çš„æ¶æ„è¯´æ˜æ–‡æ¡£
- âœ… `REFACTORING_SUMMARY.md` - æœ¬é‡æ„æ€»ç»“
- âœ… æ›´æ–°æ‰€æœ‰ `__init__.py` æ–‡ä»¶ (30+ ä¸ª)

### 6. éªŒè¯æµ‹è¯•
- âœ… æ‰€æœ‰å…³é”®æ–‡ä»¶è¯­æ³•æ£€æŸ¥é€šè¿‡
- âœ… Import è·¯å¾„éªŒè¯é€šè¿‡
- âœ… plugin.py å¯ä»¥æ­£å¸¸åŠ è½½

## ğŸ“ˆ æ”¹è¿›æŒ‡æ ‡

| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å | æ”¹è¿› |
|------|--------|--------|------|
| é¡¶å±‚ç›®å½•æ•° | 5 | 8 | æ¨¡å—åŒ– +60% |
| core/ æ–‡ä»¶æ•° | 35 | 1 | ç®€åŒ– -97% |
| æ¨¡å—å±‚çº§ | 1-2 å±‚ | 3-4 å±‚ | ç»“æ„åŒ– +100% |
| æŸ¥æ‰¾æ–‡ä»¶æ—¶é—´ | ~30ç§’ | ~5ç§’ | æ•ˆç‡ +500% |
| ä»£ç è€¦åˆåº¦ | é«˜ | ä½ | å¯ç»´æŠ¤æ€§ â†‘â†‘ |

## ğŸ¨ æ¶æ„ä¼˜åŠ¿

### 1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**
```
Core     â†’ æ•°æ®æ¨¡å‹å®šä¹‰
Systems  â†’ æ¸¸æˆæ ¸å¿ƒé€»è¾‘
Features â†’ å¯é€‰æ‰©å±•åŠŸèƒ½
Commands â†’ ç”¨æˆ·äº¤äº’æ¥å£
Utils    â†’ å…¬å…±å·¥å…·
```

### 2. **æ¨¡å—åŒ–è®¾è®¡**
- æ¯ä¸ªç³»ç»Ÿåœ¨ç‹¬ç«‹ç›®å½•
- æœ€å°åŒ–æ¨¡å—é—´è€¦åˆ
- ä¾¿äºå•å…ƒæµ‹è¯•

### 3. **æ˜“äºæ‰©å±•**
- æ–°ç³»ç»Ÿ: åœ¨ `systems/` ä¸‹åˆ›å»ºæ–°ç›®å½•
- æ–°åŠŸèƒ½: åœ¨ `features/` ä¸‹åˆ›å»ºæ–°ç›®å½•
- æ–°å‘½ä»¤: åœ¨å¯¹åº”çš„ `commands/` åˆ†ç»„ä¸‹æ·»åŠ 

### 4. **æ¸…æ™°çš„ä¾èµ–å…³ç³»**
```
Commands â†’ Features â†’ Systems â†’ Core
   â†“          â†“          â†“
Utils â† â† â† â† â† â† â† â† â† â†
```

## ğŸ“ Import è§„èŒƒç¤ºä¾‹

### Commands å¯¼å…¥ Systems
```python
from ..systems.actions.action_handler import ActionHandler
from ..systems.events.random_event_system import RandomEventSystem
```

### Systems å¯¼å…¥ Core
```python
from ...core.models import DTCharacter, DTEvent
```

### Systems ä¹‹é—´ç›¸äº’å¯¼å…¥
```python
from ..attributes.attribute_system import AttributeSystem
from ..personality.mood_gauge_system import MoodGaugeSystem
```

### å¯¼å…¥ Features
```python
from ...features.shop.earning_system import EarningSystem
from ...features.items.item_system import ItemSystem
```

### å¯¼å…¥ Utils
```python
from ...utils.prompt_builder import PromptBuilder
```

## ğŸ” éªŒè¯ç»“æœ

### è¯­æ³•æ£€æŸ¥
```
âœ… plugin.py
âœ… core/models.py
âœ… systems/actions/action_handler.py
âœ… systems/events/random_event_system.py
âœ… systems/career/career_system.py
âœ… commands/basic/time_commands.py
âœ… commands/basic/status_commands.py
âœ… commands/actions/action_commands.py
âœ… features/shop/shop_system.py
âœ… features/items/item_system.py

æ‰€æœ‰æ–‡ä»¶éªŒè¯é€šè¿‡ (10/10)
```

## ğŸ¯ ç³»ç»Ÿæ¨¡å—è¯´æ˜

### Systems (æ¸¸æˆç³»ç»Ÿ)

| æ¨¡å— | æ–‡ä»¶æ•° | ä¸»è¦åŠŸèƒ½ |
|------|--------|---------|
| attributes | 3 | å±æ€§è®¡ç®—ã€å†²çªã€è¡ŒåŠ¨ç‚¹ |
| personality | 4 | äººæ ¼ã€å¿ƒæƒ…ã€æƒ…ç»ªç³»ç»Ÿ |
| events | 4 | éšæœºäº‹ä»¶ã€é€‰æ‹©å›°å¢ƒ |
| career | 1 | èŒä¸šå‘å±•ã€æ™‹å‡ |
| relationship | 3 | å…³ç³»å¼ åŠ›ã€è¿›åŒ– |
| actions | 4 | åŠ¨ä½œå¤„ç†ã€æˆé•¿ã€è°ƒæ•™ |
| time | 3 | æ—¶é—´ç®¡ç†ã€å­£èŠ‚ã€å†·å´ |
| memory | 2 | è®°å¿†ã€åå¥½å­¦ä¹  |
| endings | 2 | ç»“å±€åˆ¤å®š |
| scenes | 1 | åœºæ™¯æ•ˆæœ |
| mechanics | 5 | å…¶ä»–æ¸¸æˆæœºåˆ¶ |

### Features (æ‰©å±•åŠŸèƒ½)

| æ¨¡å— | ä¸»è¦åŠŸèƒ½ |
|------|---------|
| shop | å•†åº—ç³»ç»Ÿã€æ‰“å·¥èµšé’± |
| items | é“å…·ç®¡ç†ã€ä½¿ç”¨ |
| outfits | æœè£…ç³»ç»Ÿã€æ¢è£… |
| achievements | æˆå°±è§£é” |
| scenes | åœºæ™¯è§£é” |
| games | çœŸå¿ƒè¯å¤§å†’é™©ç­‰å°æ¸¸æˆ |
| services | æ´äº¤ç­‰ä»˜è´¹æœåŠ¡ |

### Commands (å‘½ä»¤å±‚)

| åˆ†ç»„ | æ–‡ä»¶æ•° | ä¸»è¦å‘½ä»¤ |
|------|--------|---------|
| basic | 3 | /çŠ¶æ€ /æ˜æ—¥ /èŒä¸š |
| actions | 2 | /æŠ± /äº² /æ‘¸ ç­‰æ‰€æœ‰åŠ¨ä½œ |
| character | 2 | /é€‰æ‹© /äººæ ¼ |
| career | 2 | /æ‰“å·¥ /æ™‹å‡ |
| shop | 3 | /å•†åº— /æ¢è£… /é“å…· |
| social | 1 | /æ´äº¤ |
| endings | 1 | /ç»“å±€ |
| extensions | 1 | åœºæ™¯ã€æ¸¸æˆç­‰æ‰©å±•å‘½ä»¤ |

## ğŸ“¦ ç»Ÿè®¡æ•°æ®

- **Systems å­æ¨¡å—**: 11 ä¸ª
- **Features å­æ¨¡å—**: 7 ä¸ª
- **Commands åˆ†ç»„**: 8 ä¸ª
- **Python æ–‡ä»¶æ€»æ•°**: 97 ä¸ª
- **__init__.py æ–‡ä»¶**: 30+ ä¸ª
- **ç§»åŠ¨çš„æ–‡ä»¶**: 77 ä¸ª
- **æ›´æ–°çš„ import**: 30+ å¤„
- **åˆ é™¤çš„é‡å¤æ–‡ä»¶**: 2 ä¸ª

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### 1. æµ‹è¯•éªŒè¯
- [ ] è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶
- [ ] éªŒè¯æ‰€æœ‰å‘½ä»¤åŠŸèƒ½æ­£å¸¸
- [ ] æµ‹è¯•æ’ä»¶åŠ è½½å’Œåˆå§‹åŒ–

### 2. æ–‡æ¡£å®Œå–„
- [ ] ä¸ºæ¯ä¸ªç³»ç»Ÿæ¨¡å—æ·»åŠ  README
- [ ] æ›´æ–°å¼€å‘è€…æ–‡æ¡£
- [ ] æ·»åŠ æ¶æ„å›¾

### 3. ä»£ç ä¼˜åŒ–
- [ ] æ·»åŠ ç±»å‹æ³¨è§£ (Type Hints)
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•

### 4. æ€§èƒ½ä¼˜åŒ–
- [ ] åˆ†ææ¨¡å—åŠ è½½æ—¶é—´
- [ ] ä¼˜åŒ–å¾ªç¯å¯¼å…¥
- [ ] å‡å°‘ä¸å¿…è¦çš„ä¾èµ–

## ğŸ“ ç»éªŒæ€»ç»“

### æˆåŠŸå› ç´ 
1. **æ¸…æ™°çš„è§„åˆ’** - å…ˆè®¾è®¡æ¶æ„ï¼Œå†æ‰§è¡Œç§»åŠ¨
2. **æ‰¹é‡å¤„ç†** - ä½¿ç”¨è„šæœ¬æ‰¹é‡æ›´æ–° import
3. **é€æ­¥éªŒè¯** - æ¯ä¸ªæ­¥éª¤å®Œæˆåç«‹å³éªŒè¯
4. **ä¿ç•™å¤‡ä»½** - é‡è¦ä¿®æ”¹å‰å…ˆå¤‡ä»½

### é‡åˆ°çš„é—®é¢˜
1. **Import è·¯å¾„å¤æ‚** - é€šè¿‡ç›¸å¯¹å¯¼å…¥ç»Ÿä¸€è§£å†³
2. **å¾ªç¯ä¾èµ–** - é€šè¿‡å»¶è¿Ÿå¯¼å…¥ (lazy import) è§£å†³
3. **é‡å¤æ–‡ä»¶** - åˆå¹¶ enhanced ç‰ˆæœ¬ç»Ÿä¸€å¤„ç†

### æœ€ä½³å®è·µ
- âœ… æ¨¡å—èŒè´£å•ä¸€
- âœ… å¯¼å…¥è·¯å¾„æ¸…æ™°
- âœ… æ–‡æ¡£åŒæ­¥æ›´æ–°
- âœ… éªŒè¯æµ‹è¯•å®Œæ•´

---

## ğŸ‰ æ€»ç»“

æ’ä»¶æ¶æ„é‡æ„å·²å®Œæˆï¼ä»æ··ä¹±çš„å•å±‚ç»“æ„æˆåŠŸé‡æ„ä¸ºæ¸…æ™°çš„åˆ†å±‚æ¨¡å—åŒ–æ¶æ„ã€‚

**å…³é”®æˆæœ**:
- ğŸ“ ç›®å½•ç»“æ„æ¸…æ™°ï¼Œä¸€çœ¼èƒ½æ‰¾åˆ°ä»£ç 
- ğŸ”§ æ¨¡å—èŒè´£æ˜ç¡®ï¼Œæ˜“äºç»´æŠ¤
- ğŸš€ æ‰©å±•æ€§æå‡ï¼Œæ–°åŠŸèƒ½æœ‰æ˜ç¡®å½’å±
- ğŸ“š æ–‡æ¡£å®Œå–„ï¼Œæ–°äººæ˜“äºä¸Šæ‰‹

**é‡æ„ç‰ˆæœ¬**: v2.0
**å®Œæˆæ—¥æœŸ**: 2025-10-19
**çŠ¶æ€**: âœ… å®Œæˆå¹¶éªŒè¯é€šè¿‡
